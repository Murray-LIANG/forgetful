<!DOCTYPE html>
<html lang="en">
    <head><script src="/forgetful/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=forgetful/livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>OSP12 Containerization Tips | Forgetful :/</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="Notes about everything"><link rel="prev" href="http://localhost:1313/forgetful/2020/02/osp13-tripleo/" /><link rel="next" href="http://localhost:1313/forgetful/2020/02/openvswitch-auto-start/" /><link rel="canonical" href="http://localhost:1313/forgetful/2020/02/osp12-containerization/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><meta property="og:title" content="OSP12 Containerization Tips" />
<meta property="og:description" content="Install the undercloud according to official doc  NOTE: The files/folders used below are under ~/templates
Edit the openstack-tripleo-heat-templates/environments/docker.yaml to enable the docker image for cinder/manila 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  git diff openstack-tripleo-heat-templates/environments/ diff --git a/openstack-tripleo-heat-templates/environments/docker.yaml b/openstack-tripleo-heat-templates/environments/docker.yaml index 223a179..faef160 100644 --- a/openstack-tripleo-heat-templates/environments/docker.yaml &#43;&#43;&#43; b/openstack-tripleo-heat-templates/environments/docker.yaml @@ -51,14 &#43;51,18 @@ resource_registry:  OS::TripleO::Services::Horizon: ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/forgetful/2020/02/osp12-containerization/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-10T16:37:31+08:00" />
<meta property="article:modified_time" content="2020-02-10T16:37:31+08:00" />

<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "OSP12 Containerization Tips",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/forgetful\/2020\/02\/osp12-containerization\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/localhost:1313\/forgetful\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "osp, osp12, container, containerization, tips","wordcount":  1420 ,
        "url": "http:\/\/localhost:1313\/forgetful\/2020\/02\/osp12-containerization\/","datePublished": "2020-02-10T16:37:31\u002b08:00","dateModified": "2020-02-10T16:37:31\u002b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "murray",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/localhost:1313\/forgetful\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"description": ""
    }
    </script><link rel="stylesheet" href="/forgetful/css/style.min.css"><link rel="stylesheet" href="/forgetful/css/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/forgetful/css/lib/forkawesome/forkawesome.min.css"><link rel="stylesheet" href="/forgetful/css/lib/animate/animate.min.css"></head>
    <body><script>
            if (!window.localStorage || !window.localStorage.getItem('theme')) {
                window.isDark = 'dark' === 'dark';
            } else {
                window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            }
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="http://localhost:1313/forgetful/">Forgetful :/</a>
        </div>
        <div class="navbar-menu"><a class="menu-item" href="http://localhost:1313/forgetful/posts" title="">Posts</a><a class="menu-item" href="http://localhost:1313/forgetful/tags" title="">Tags</a><a class="menu-item" href="http://localhost:1313/forgetful/categories" title="">Categories</a><a class="menu-item" href="http://localhost:1313/forgetful/about" title="">About</a><a class="menu-item" href="https://github.com/Murray-LIANG/forgetful" title="简体中文"><i class="fas fa-language fa-fw"></i></a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav><nav class="navbar-mobile">
    <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="http://localhost:1313/forgetful/">Forgetful :/</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu"><a class="menu-item" href="http://localhost:1313/forgetful/posts" title="">Posts</a><a class="menu-item" href="http://localhost:1313/forgetful/tags" title="">Tags</a><a class="menu-item" href="http://localhost:1313/forgetful/categories" title="">Categories</a><a class="menu-item" href="http://localhost:1313/forgetful/about" title="">About</a><a class="menu-item" href="https://github.com/Murray-LIANG/forgetful" title="简体中文"></a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav>
<main class="main">
                <div class="container"><article class="page"><h1 class="post-title animated flipInX">OSP12 Containerization Tips</h1><div class="post-meta">
            <div class="post-meta-main"><a class="author" href="https://github.com/Murray-LIANG" rel="author" target="_blank">
                    <i class="fas fa-user-circle fa-fw"></i>Murray-LIANG
                </a>&nbsp;</div>
            <div class="post-meta-other"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-02-10>2020-02-10</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>about 1420 words&nbsp;
                <i class="far fa-clock fa-fw"></i>7 min&nbsp;</div>
        </div><div class="post-toc" id="post-toc">
                <h2 class="post-toc-title">Contents</h2>
                <div class="post-toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#install-the-undercloud-according-to-official-dochttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform13htmldirector_installation_and_usageinstalling-the-undercloud">Install the undercloud according to <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/13/html/director_installation_and_usage/installing-the-undercloud">official doc</a></a></li>
    <li><a href="#edit-the-openstack-tripleo-heat-templatesenvironmentsdockeryaml-to-enable-the-docker-image-for-cindermanila">Edit the <code>openstack-tripleo-heat-templates/environments/docker.yaml</code> to enable the docker image for cinder/manila</a></li>
    <li><a href="#use-command-to-enable-the-cindermanila-container-image">Use command to enable the cinder/manila container image</a></li>
    <li><a href="#create-a-template-environment-file-for-vnx-cinder">Create a template environment file for vnx cinder</a></li>
    <li><a href="#node-introspection-using-fake_pxehttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform12htmldirector_installation_and_usageappe-power_management_drivers">Node introspection using <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/12/html/director_installation_and_usage/appe-Power_Management_Drivers">fake_pxe</a></a></li>
    <li><a href="#use-following-command-to-generate-overcloud_imagesyaml">Use following command to generate <code>overcloud_images.yaml</code></a></li>
    <li><a href="#import-the-node-yaml">Import the node yaml</a></li>
    <li><a href="#define-the-profileflavor">Define the profile/flavor</a></li>
    <li><a href="#deploy-the-overcloud-by-openstack-overcloud-deploy---">Deploy the overcloud by <code>openstack overcloud deploy</code>   ​</a></li>
    <li><a href="#if-deploy-failed-clean-the-stack">If deploy failed, clean the stack</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav></div>
            </div>
            <div class="post-toc-mobile" id="post-toc-mobile">
                <details>
                    <summary>
                        <div class="post-toc-title">
                            <span>Contents</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="post-toc-content"><nav id="TableOfContentsMobile">
  <ul>
    <li><a href="#install-the-undercloud-according-to-official-dochttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform13htmldirector_installation_and_usageinstalling-the-undercloud">Install the undercloud according to <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/13/html/director_installation_and_usage/installing-the-undercloud">official doc</a></a></li>
    <li><a href="#edit-the-openstack-tripleo-heat-templatesenvironmentsdockeryaml-to-enable-the-docker-image-for-cindermanila">Edit the <code>openstack-tripleo-heat-templates/environments/docker.yaml</code> to enable the docker image for cinder/manila</a></li>
    <li><a href="#use-command-to-enable-the-cindermanila-container-image">Use command to enable the cinder/manila container image</a></li>
    <li><a href="#create-a-template-environment-file-for-vnx-cinder">Create a template environment file for vnx cinder</a></li>
    <li><a href="#node-introspection-using-fake_pxehttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform12htmldirector_installation_and_usageappe-power_management_drivers">Node introspection using <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/12/html/director_installation_and_usage/appe-Power_Management_Drivers">fake_pxe</a></a></li>
    <li><a href="#use-following-command-to-generate-overcloud_imagesyaml">Use following command to generate <code>overcloud_images.yaml</code></a></li>
    <li><a href="#import-the-node-yaml">Import the node yaml</a></li>
    <li><a href="#define-the-profileflavor">Define the profile/flavor</a></li>
    <li><a href="#deploy-the-overcloud-by-openstack-overcloud-deploy---">Deploy the overcloud by <code>openstack overcloud deploy</code>   ​</a></li>
    <li><a href="#if-deploy-failed-clean-the-stack">If deploy failed, clean the stack</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav></div>
                </details>
            </div><div class="post-content"><a class="post-dummy-target" id="install-the-undercloud-according-to-official-dochttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform13htmldirector_installation_and_usageinstalling-the-undercloud"></a><h2>Install the undercloud according to <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/13/html/director_installation_and_usage/installing-the-undercloud" target="_blank">official doc</a>
</h2>
<p><strong>NOTE: The files/folders used below are under ~/templates</strong></p>
<a class="post-dummy-target" id="edit-the-openstack-tripleo-heat-templatesenvironmentsdockeryaml-to-enable-the-docker-image-for-cindermanila"></a><h2>Edit the <code>openstack-tripleo-heat-templates/environments/docker.yaml</code> to enable the docker image for cinder/manila</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff">git diff openstack-tripleo-heat-templates/environments/
<span class="gh">diff --git a/openstack-tripleo-heat-templates/environments/docker.yaml b/openstack-tripleo-heat-templates/environments/docker.yaml
</span><span class="gh">index 223a179..faef160 100644
</span><span class="gh"></span><span class="gd">--- a/openstack-tripleo-heat-templates/environments/docker.yaml
</span><span class="gd"></span><span class="gi">+++ b/openstack-tripleo-heat-templates/environments/docker.yaml
</span><span class="gi"></span><span class="gu">@@ -51,14 +51,18 @@ resource_registry:
</span><span class="gu"></span>    OS::TripleO::Services::Horizon: ../docker/services/horizon.yaml
    # Because Cinder services currently run on bare metal (see FIXME), Iscsid
    # and Multipathd must run there as well.
<span class="gd">-  # OS::TripleO::Services::Iscsid: ../docker/services/iscsid.yaml
</span><span class="gd">-  # OS::TripleO::Services::Multipathd: ../docker/services/multipathd.yaml
</span><span class="gd"></span><span class="gi">+  OS::TripleO::Services::Iscsid: ../docker/services/iscsid.yaml
</span><span class="gi">+  OS::TripleO::Services::Multipathd: ../docker/services/multipathd.yaml
</span><span class="gi"></span>    OS::TripleO::Services::ContainersLogrotateCrond: ../docker/services/logrotate-crond.yaml
    # FIXME: Had to remove these to unblock containers CI. They should be put back when fixed.
<span class="gd">-  # OS::TripleO::Services::CinderApi: ../docker/services/cinder-api.yaml
</span><span class="gd">-  # OS::TripleO::Services::CinderScheduler: ../docker/services/cinder-scheduler.yaml
</span><span class="gd">-  # OS::TripleO::Services::CinderBackup: ../docker/services/cinder-backup.yaml
</span><span class="gd">-  # OS::TripleO::Services::CinderVolume: ../docker/services/cinder-volume.yaml
</span><span class="gd"></span><span class="gi">+  OS::TripleO::Services::CinderApi: ../docker/services/cinder-api.yaml
</span><span class="gi">+  OS::TripleO::Services::CinderScheduler: ../docker/services/cinder-scheduler.yaml
</span><span class="gi">+  OS::TripleO::Services::CinderBackup: ../docker/services/cinder-backup.yaml
</span><span class="gi">+  OS::TripleO::Services::CinderVolume: ../docker/services/cinder-volume.yaml
</span><span class="gi">+  # FIXME(peter): Added manila docker services
</span><span class="gi">+  OS::TripleO::Services::ManilaApi: ../docker/services/manila-api.yaml
</span><span class="gi">+  OS::TripleO::Services::ManilaScheduler: ../docker/services/manila-scheduler.yaml
</span><span class="gi">+  OS::TripleO::Services::ManilaShare: ../docker/services/manila-share.yaml
</span><span class="gi"></span>    #
    OS::TripleO::Services::SwiftDispersion: OS::Heat::None
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="use-command-to-enable-the-cindermanila-container-image"></a><h2>Use command to enable the cinder/manila container image</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">openstack --debug overcloud container image prepare <span class="se">\
</span><span class="se"></span>    --namespace<span class="o">=</span>registry.access.redhat.com/rhosp12 <span class="se">\
</span><span class="se"></span>    --prefix<span class="o">=</span>openstack- --tag<span class="o">=</span>12.0-20180124.1 <span class="se">\
</span><span class="se"></span>    --environment-directory /home/stack/templates <span class="se">\
</span><span class="se"></span>    -e openstack-tripleo-heat-templates/environments/docker.yaml <span class="se">\
</span><span class="se"></span>    --output-env-file<span class="o">=</span>/home/stack/templates/overcloud_images.yaml
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="create-a-template-environment-file-for-vnx-cinder"></a><h2>Create a template environment file for vnx cinder</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ cat /home/stack/templates/emc_customized/custom-vnx-cinder.yaml
volumerameters: <span class="c1"># 1</span>
    CinderEnableIscsiBackend: <span class="nb">false</span>
    CinderEnableRbdBackend: <span class="nb">false</span>
    CinderEnableNfsBackend: <span class="nb">false</span>
    NovaEnableRbdBackend: <span class="nb">false</span>
    GlanceBackend: file <span class="c1"># 2</span>

parameter_defaults:
    ControllerExtraConfig: <span class="c1"># 3</span>
    cinder::config::cinder_config:
        vnx1/volume_driver: <span class="c1"># 4</span>
            value: cinder.volume.drivers.dell_emc.vnx.driver.VNXDriver
        vnx1/san_ip: <span class="c1"># 4</span>
            value: 192.168.1.50
        vnx1/san_login: <span class="c1"># 4</span>
            value: sysadmin
        vnx1/san_password: <span class="c1"># 4</span>
            value: sysadmin
        vnx1/naviseccli_path: <span class="c1"># 4</span>
            value: /opt/Navisphere/bin/naviseccli
        vnx1/initiator_auto_registration: <span class="c1"># 4</span>
            value: True
        vnx1/storage_protocol: <span class="c1"># 4</span>
            value: iscsi
        vnx2/volume_driver: <span class="c1"># 4</span>
            value: cinder.volume.drivers.dell_emc.vnx.driver.VNXDriver
        vnx2/san_ip: <span class="c1"># 4</span>
            value: 192.168.1.50
        vnx2/san_login: <span class="c1"># 4</span>
            value: sysadmin
        vnx2/san_password: <span class="c1"># 4</span>
            value: sysadmin
        vnx2/naviseccli_path: <span class="c1"># 4</span>
            value: /opt/Navisphere/bin/naviseccli
        vnx2/initiator_auto_registration: <span class="c1"># 4</span>
            value: True
        vnx2/storage_protocol: <span class="c1"># 4</span>
            value: iscsi
    cinder_user_enabled_backends: <span class="o">[</span><span class="s1">&#39;vnx1&#39;</span>,<span class="s1">&#39;vnx2&#39;</span><span class="o">]</span> <span class="c1"># 7</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="node-introspection-using-fake_pxehttpsaccessredhatcomdocumentationen-usred_hat_openstack_platform12htmldirector_installation_and_usageappe-power_management_drivers"></a><h2>Node introspection using <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/12/html/director_installation_and_usage/appe-Power_Management_Drivers" target="_blank">fake_pxe</a>
</h2>
<p><strong>For customer, they need to update the generated <code>overcloud_images.yaml</code> to use DELLEMC customized image.</strong></p>
<a class="post-dummy-target" id="use-following-command-to-generate-overcloud_imagesyaml"></a><h2>Use following command to generate <code>overcloud_images.yaml</code></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># first use below command to get the latest version of OpenStack</span>
$ openstack overcloud container image tag discover <span class="se">\
</span><span class="se"></span>    --image registry.access.redhat.com/rhosp12/openstack-base:latest <span class="se">\
</span><span class="se"></span>    --tag-from-label version-release
$ 12.0-20180319.1
<span class="c1"># Copy the returned string and set to --tag=&lt;TAG&gt;</span>
<span class="c1"># then pull the docker image from the remote to local, to avoid some</span>
<span class="c1"># occasional network failure on the corp network</span>

$ openstack overcloud container image prepare <span class="se">\
</span><span class="se"></span>    --namespace<span class="o">=</span>registry.access.redhat.com/rhosp12 <span class="se">\
</span><span class="se"></span>    --prefix<span class="o">=</span>openstack- <span class="se">\
</span><span class="se"></span>    --environment-directory /home/stack/templates <span class="se">\
</span><span class="se"></span>    -e openstack-tripleo-heat-templates/environments/docker.yaml <span class="se">\
</span><span class="se"></span>    --tag<span class="o">=</span>12.0-20180319.1 <span class="se">\
</span><span class="se"></span>    --output-images-file /home/stack/local_registry_images.yaml

$ openstack overcloud container image upload <span class="se">\
</span><span class="se"></span>    --config-file /home/stack/local_registry_images.yaml --verbose

$ openstack --debug overcloud container image prepare <span class="se">\
</span><span class="se"></span>    --namespace<span class="o">=</span>192.168.139.1:8787/rhosp12 <span class="se">\
</span><span class="se"></span>    --prefix<span class="o">=</span>openstack- <span class="se">\
</span><span class="se"></span>    --tag<span class="o">=</span>12.0-20180319.1 <span class="se">\
</span><span class="se"></span>    --environment-directory /home/stack/templates <span class="se">\
</span><span class="se"></span>    -e openstack-tripleo-heat-templates/environments/docker.yaml <span class="se">\
</span><span class="se"></span>    --output-env-file<span class="o">=</span>/home/stack/templates/overcloud_images.yaml

</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="import-the-node-yaml"></a><h2>Import the node yaml</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ openstack overcloud node import ~/templates/instackenv.json

$ openstack baremetal node list

<span class="c1"># before introspect, suggest to create new VMs for discovery</span>
<span class="c1"># NOTE, the DHCP/BOOTP only works when issuing following introspect command</span>
$ openstack overcloud node introspect --all-manageable --provide
<span class="c1"># Debug the dhcp/bootp process</span>
$ sudo journalctl -l -u openstack-ironic-inspector -u openstack-ironic-inspector-dnsmasq -uopenstack-ironic-conductor -f

$ openstack baremetal introspection interface list <span class="o">[</span>NODE UUID<span class="o">]</span>
$ openstack baremetal introspection interface show <span class="o">[</span>NODE UUID<span class="o">]</span> 

$ openstack baremetal introspection data save _UUID_ <span class="p">|</span> jq .numa_topology
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="define-the-profileflavor"></a><h2>Define the profile/flavor</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># After introspection completes, check the nodes and their assigned profiles:</span>

$ openstack overcloud profiles list
<span class="c1"># If you made a mistake in introspection rules, you can delete them all:</span>
$ openstack baremetal introspection rule purge

<span class="c1"># update the flavor to fit the compute/control capabilities</span>
<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud ~<span class="o">]</span>$ openstack flavor delete control
<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud ~<span class="o">]</span>$ openstack flavor delete compute
<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud ~<span class="o">]</span>$ openstack flavor create --id auto --ram <span class="m">8192</span> --disk <span class="m">80</span> --vcpus <span class="m">8</span> control

<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud ~<span class="o">]</span>$ openstack flavor create --id auto --ram <span class="m">8192</span> --disk <span class="m">80</span> --vcpus <span class="m">8</span> compute

<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud ~<span class="o">]</span>$ openstack flavor list
+--------------------------------------+---------------+------+------+-----------+-------+-----------+
<span class="p">|</span> ID                                   <span class="p">|</span> Name          <span class="p">|</span>  RAM <span class="p">|</span> Disk <span class="p">|</span> Ephemeral <span class="p">|</span> VCPUs <span class="p">|</span> Is Public <span class="p">|</span>
+--------------------------------------+---------------+------+------+-----------+-------+-----------+
<span class="p">|</span> 14772f1a-78de-435e-8e41-ba68a90f06e9 <span class="p">|</span> block-storage <span class="p">|</span> <span class="m">4096</span> <span class="p">|</span>   <span class="m">40</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> 3897718f-1ebc-4d57-80a3-41442bbb8c8b <span class="p">|</span> swift-storage <span class="p">|</span> <span class="m">4096</span> <span class="p">|</span>   <span class="m">40</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> 68f4e6dc-376b-4350-90d5-e65dd04682b8 <span class="p">|</span> compute       <span class="p">|</span> <span class="m">8192</span> <span class="p">|</span>   <span class="m">80</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">8</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> 9b823562-7857-41ae-9c1f-b4434d06526f <span class="p">|</span> baremetal     <span class="p">|</span> <span class="m">4096</span> <span class="p">|</span>   <span class="m">40</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> b602bb59-862d-4d01-8455-4f7ac1e94388 <span class="p">|</span> networker     <span class="p">|</span> <span class="m">4096</span> <span class="p">|</span>   <span class="m">40</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> e473b971-5ccb-421c-8526-c42eabe5f0bd <span class="p">|</span> control       <span class="p">|</span> <span class="m">8192</span> <span class="p">|</span>   <span class="m">80</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">8</span> <span class="p">|</span> True      <span class="p">|</span>
<span class="p">|</span> ec2b9ea9-c327-49a7-a564-fafe9b6b9984 <span class="p">|</span> ceph-storage  <span class="p">|</span> <span class="m">4096</span> <span class="p">|</span>   <span class="m">40</span> <span class="p">|</span>         <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span> True      <span class="p">|</span>
+--------------------------------------+---------------+------+------+-----------+-------+-----------+

<span class="o">(</span>undercloud<span class="o">)</span> $ openstack baremetal node <span class="nb">set</span> --property <span class="se">\
</span><span class="se"></span>    <span class="nv">capabilities</span><span class="o">=</span><span class="s1">&#39;profile:control,boot_option:local&#39;</span> <span class="se">\
</span><span class="se"></span>    ade5c771-dfc9-4216-b7fa-3f278248c88a
<span class="o">(</span>undercloud<span class="o">)</span> $ openstack baremetal node <span class="nb">set</span> --property <span class="se">\
</span><span class="se"></span>    <span class="nv">capabilities</span><span class="o">=</span><span class="s1">&#39;profile:compute,boot_option:local&#39;</span> <span class="se">\
</span><span class="se"></span>    ec149c12-c9fd-4891-8026-2e5a4dc0875c

</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="deploy-the-overcloud-by-openstack-overcloud-deploy---"></a><h2>Deploy the overcloud by <code>openstack overcloud deploy</code>   ​</h2>
<ul>
<li>Create the <code>node-info.yaml</code> for overcloud</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>stack@undercloud templates<span class="o">]</span>$ cat node-info.yaml
parameter_defaults:
    OvercloudControllerFlavor: control
    OvercloudComputeFlavor: compute
    ControllerCount: <span class="m">1</span>
    ComputeCount: <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Create the EMC VNX backend for Cinder</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="p">[</span><span class="l">stack@undercloud emc_customized]$ cat custom-vnx-cinder.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="c"># 1</span><span class="w">
</span><span class="w">    </span><span class="nt">CinderEnableIscsiBackend</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="nt">CinderEnableRbdBackend</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="nt">CinderEnableNfsBackend</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="nt">NovaEnableRbdBackend</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w"></span><span class="c">#  GlanceBackend: file # 2</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">parameter_defaults</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">ControllerExtraConfig</span><span class="p">:</span><span class="w"> </span><span class="c"># 3</span><span class="w">
</span><span class="w">    </span><span class="nt">cinder::config::cinder_config</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/volume_driver</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cinder.volume.drivers.dell_emc.vnx.driver.VNXDriver</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/san_ip</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.1.50</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/san_login</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">sysadmin</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/san_password</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">sysadmin</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/naviseccli_path</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/Navisphere/bin/naviseccli</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/initiator_auto_registration</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx1/storage_protocol</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">iscsi</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/volume_driver</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">cinder.volume.drivers.dell_emc.vnx.driver.VNXDriver</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/san_ip</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">192.168.1.50</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/san_login</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">sysadmin</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/san_password</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">sysadmin</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/naviseccli_path</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/Navisphere/bin/naviseccli</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/initiator_auto_registration</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span><span class="w">        </span><span class="nt">vnx2/storage_protocol</span><span class="p">:</span><span class="w"> </span><span class="c"># 4</span><span class="w">
</span><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">iscsi</span><span class="w">
</span><span class="w">    </span><span class="nt">cinder_user_enabled_backends</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;vnx1&#39;</span><span class="p">,</span><span class="s1">&#39;vnx2&#39;</span><span class="p">]</span><span class="w"> </span><span class="c"># 7</span><span class="w">
</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Enable VNX/Cinder service in <code>vim overcloud-resource-registry-puppet.j2.yaml</code></p>
</li>
<li>
<p>Deploy the templates</p>
</li>
</ul>
<p><strong>NOTE: After running below <code>deploy</code> command, you will need to power on
the overcloud VMs twice. When to power on? The practice is that run
command <code>watch -n 5 openstack baremetal node list</code> in another terminal,
the first time to power on is when you see status <code>deploy  wait-callback</code>. The second time is after the status changes to
<code>Active</code> but the VMs is off. For more detail, refer to <a href="https://oglok.github.io/2016-11-16-Faxe_pxe-Driver-Workflow-on-TripleO/" target="_blank">this wiki</a>
.</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ openstack overcloud deploy --templates /usr/share/openstack-tripleo-heat-templates <span class="se">\
</span><span class="se"></span>    -e /home/stack/templates/node-info.yaml <span class="se">\
</span><span class="se"></span>    -e /home/stack/templates/overcloud_images.yaml <span class="se">\
</span><span class="se"></span>    -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml <span class="se">\
</span><span class="se"></span>    -e emc_customized/custom-vnx-cinder.yaml <span class="se">\
</span><span class="se"></span>    -e /home/stack/templates/openstack-tripleo-heat-templates/environments/docker.yaml <span class="se">\
</span><span class="se"></span>    -e openstack-tripleo-heat-templates/environments/docker-ha.yaml <span class="se">\
</span><span class="se"></span>    -e /usr/share/openstack-tripleo-heat-templates/environments/disable-telemetry.yaml <span class="se">\
</span><span class="se"></span>    -e /home/stack/templates/network-environment.yaml <span class="se">\
</span><span class="se"></span>    -e emc_customized/custom-containers.yaml <span class="se">\
</span><span class="se"></span>    --ntp-server 10.244.255.118
</code></pre></td></tr></table>
</div>
</div><ul>
<li>During deployment, check the status</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ openstack stack list --nested

$ openstack stack resource list overcloud

$ openstack stack resource list overcloud --filter <span class="nv">status</span><span class="o">=</span>FAILED 
$ openstack stack resource show &lt;resource&gt;
<span class="c1"># from sam&#39;s tips</span>
$ openstack stack failures list --long overcloud  
</code></pre></td></tr></table>
</div>
</div><p><strong>Tips</strong>(<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_openstack_platform/7/html/director_installation_and_usage/sect-fake_driver" target="_blank">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_openstack_platform/7/html/director_installation_and_usage/sect-fake_driver</a>
)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown">Additional Notes

<span class="k">-</span> This driver does not use any authentication details because it does not control power management.
<span class="k">-</span> Edit the /etc/ironic/ironic.conf file and add fake_pxe to the enabled_drivers option to enable this driver.
<span class="k">-</span> When performing introspection on nodes, manually power the nodes after running the openstack baremetal introspection bulk start command.
<span class="k">-</span> When performing Overcloud deployment, check the node status with the ironic node-list command. Wait until the node status changes from deploying to deploy <span class="gs">**wait call-back**</span> and then manually power(or reset) the nodes.
<span class="k">-</span> After the Overcloud provisioning process completes, reboot the nodes. To check the completion of provisioning, check the node status with the ironic node-list command, wait until the node status changes to active, then manually reboot all Overcloud nodes.
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Manually change the configs of the containers</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sudo vi /var/lib/config-data/puppet-generated/nova_libvirt/etc/nova/nova.conf
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="if-deploy-failed-clean-the-stack"></a><h2>If deploy failed, clean the stack</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># undeloy</span>
<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud templates<span class="o">]</span>$ openstack baremetal node undeploy  665c5b4a-8496-4929-80ed-f0859a225775
<span class="o">(</span>undercloud<span class="o">)</span> <span class="o">[</span>stack@undercloud templates<span class="o">]</span>$ openstack baremetal node undeploy  3d29830f-712f-4a3e-a87b-4b64eb9ac3b8
<span class="c1"># delete stack</span>
$ openstack  stack  delete overcloud

<span class="c1"># Delete plan</span>
$ openstack overcloud plan delete overcloud

<span class="c1"># Delete the baremetal nodes</span>
$ openstack baremetal node delete  b9756047-e342-4f16-bc99-df2f503b02ba fe2aa09c-7ee5-4f99-966a-8e7dbec835b5
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="troubleshooting"></a><h2>Troubleshooting</h2>
<ul>
<li>
<p>Failed to create instance</p>
<p>The error message is like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">2018-04-10 23:13:14.223 <span class="m">1</span> ERROR nova.compute.manager <span class="o">[</span>instance: 2a7c6019-62d5-4ce6-a753-1781d15aedf2<span class="o">]</span> libvirtError: internal error: process exited <span class="k">while</span> connecting to monitor: libvirt:  error : cannot execute binary /usr/libexec/qemu-kvm: Permission denied
</code></pre></td></tr></table>
</div>
</div><p>The solution: <a href="https://www.thegeekdiary.com/how-to-disable-or-set-selinux-to-permissive-mode/" target="_blank">https://www.thegeekdiary.com/how-to-disable-or-set-selinux-to-permissive-mode/</a>
</p>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2020-02-10</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><span></span></div>
        </div>
    </div>

    <div class="post-info-more">
        <section><span class="tag">
                        <a href="http://localhost:1313/forgetful/tags/osp/"><i class="fas fa-tag fa-fw"></i>&nbsp;osp</a>&nbsp;
                    </span><span class="tag">
                        <a href="http://localhost:1313/forgetful/tags/osp12/"><i class="fas fa-tag fa-fw"></i>&nbsp;osp12</a>&nbsp;
                    </span><span class="tag">
                        <a href="http://localhost:1313/forgetful/tags/container/"><i class="fas fa-tag fa-fw"></i>&nbsp;container</a>&nbsp;
                    </span><span class="tag">
                        <a href="http://localhost:1313/forgetful/tags/containerization/"><i class="fas fa-tag fa-fw"></i>&nbsp;containerization</a>&nbsp;
                    </span><span class="tag">
                        <a href="http://localhost:1313/forgetful/tags/tips/"><i class="fas fa-tag fa-fw"></i>&nbsp;tips</a>&nbsp;
                    </span></section>
        <section>
            <span><a href="javascript:window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="http://localhost:1313/forgetful/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="http://localhost:1313/forgetful/2020/02/osp13-tripleo/" class="prev" rel="prev" title="OSP13 Deployment TripleO Tips"><i class="fas fa-angle-left fa-fw"></i>OSP13 Deployment TripleO Tips</a>
            <a href="http://localhost:1313/forgetful/2020/02/openvswitch-auto-start/" class="next" rel="next" title="Openvswitch Bridge Auto Boot with Ubuntu 16.04">Openvswitch Bridge Auto Boot with Ubuntu 16.04<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div class="post-comment"></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Murray-LIANG" target="_blank">Murray-LIANG</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>
</div><a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll>
            <span>&nbsp;</span>
        </a><script src="/forgetful/js/lib/jquery/jquery.slim.min.js"></script><script src="/forgetful/js/lib/lazysizes/lazysizes.min.js"></script><script src="/forgetful/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script><link rel="stylesheet" href="/forgetful/css/lib/katex/katex.min.css"><script src="/forgetful/js/lib/katex/katex.min.js"></script><script defer src="/forgetful/js/lib/katex/auto-render.min.js"></script><link rel="stylesheet" href="/forgetful/css/lib/katex/copy-tex.min.css"><script defer src="/forgetful/js/lib/katex/copy-tex.min.js"></script><script defer src="/forgetful/js/lib/katex/mhchem.min.js"></script><script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "\\(", right: "\\)", display: false },
                    { left: "\\[", right: "\\]", display: true },{ left: "$", right: "$", display: false },]
            });
        });
    </script><script src="/forgetful/js/blog.min.js"></script>
</body>
</html>
